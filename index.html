<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    
    <title>Wolfie Dineã€€</title>
    
    <meta property="og:title" content="Wolfie Dine" />
    <meta property="og:site_name" content="Wolfie Dine" />
    <meta name="application-name" content="Wolfie Dine" />
    <meta name="apple-mobile-web-app-title" content="Wolfie Dine" />
    <meta name="description" content="Daily menus, hours, and live updates in a clean, fast view. Check whatâ€™s open, spot something tasty, and decide where to eatâ€”quickly.">
    <link rel="canonical" href="https://www.wolfiedine.com/">

    <link rel="apple-touch-icon" href="https://www.wolfiedine.com/apple-touch-icon.png">
    <link rel="icon" href="https://www.wolfiedine.com/favicon.ico" sizes="any">
    <link rel="icon" type="image/png" sizes="16x16" href="https://www.wolfiedine.com/wolfiedine_icon_16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://www.wolfiedine.com/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="48x48" href="https://www.wolfiedine.com/wolfiedine_icon_48.png">
    <link rel="icon" type="image/png" sizes="192x192" href="https://www.wolfiedine.com/wolfiedine_icon_192.png">

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        html { font-size: 16px; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #ffcdd2 0%, #ffebee 100%);
            min-height: 100vh;
            color: #333;
            -webkit-tap-highlight-color: transparent;
        }

        header {
            background: linear-gradient(135deg, #b71c1c 0%, #c62828 100%);
            color: white;
            padding: 0.8rem 0; /* ç¨å¾®å‡å°å¤´éƒ¨é«˜åº¦è…¾ç©ºé—´ */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
            animation: slideDown 0.5s ease-out;
        }

        @keyframes slideDown {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .header-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
        }

        .header-left { flex: 0 1 auto; }

        h1 {
            font-size: 1.6rem; 
            font-weight: 700;
            letter-spacing: -0.5px;
            margin: 0;
        }
        
        @media (min-width: 768px) {
            h1 { font-size: 2.5rem; letter-spacing: -1px; }
            header { padding: 1rem 0; }
        }

        .tagline {
            font-size: 0.8rem;
            opacity: 0.9;
            font-weight: 300;
            margin-top: 0.1rem;
        }

        .clock-container { flex: 0 0 auto; text-align: right; }

        .clock-time { font-size: 1.3rem; font-weight: 700; margin: 0; }
        .clock-date { font-size: 0.7rem; opacity: 0.9; margin-top: 0.1rem; }
        
        @media (min-width: 768px) {
            .clock-time { font-size: 1.8rem; }
            .clock-date { font-size: 0.85rem; }
            .tagline { font-size: 0.9rem; }
        }

        nav {
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: sticky;
            top: 0; 
            z-index: 999;
        }

        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1rem;
            display: flex;
            justify-content: center;
            gap: 1rem;
            overflow-x: auto;
        }
        
        @media (min-width: 768px) {
            .nav-container { padding: 0 2rem; gap: 2rem; }
        }

        .nav-btn {
            background: none;
            border: none;
            padding: 0.8rem 1rem;
            font-size: 0.95rem;
            font-weight: 600;
            color: #c62828;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            text-decoration: none;
            display: inline-block;
            white-space: nowrap;
        }

        .nav-btn::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 3px;
            background: #c62828;
            transition: width 0.3s ease;
        }

        .nav-btn:hover::after,
        .nav-btn.active::after { width: 100%; }
        .nav-btn:hover { color: #b71c1c; }

        main {
            max-width: 1400px;
            margin: 1rem auto;
            padding: 0 0.8rem 2rem; /* å‡å°è¾¹ç¼˜ç•™ç™½ï¼Œåˆ©ç”¨ç©ºé—´ */
        }
        
        @media (min-width: 768px) {
            main { margin: 2rem auto; padding: 0 2rem 2rem; }
        }

        .page { display: none; }
        .page.active { display: block; }

        .meal-selector {
            text-align: center;
            margin-bottom: 1.2rem; /* å‡å°é—´è· */
            animation: fadeIn 0.6s ease-out;
            background: #fff;
            border-radius: 16px;
            padding: 1rem 0.8rem;
            border: 1px solid rgba(0,0,0,.06);
            box-shadow: 0 4px 12px rgba(0,0,0,.08);
            max-width: 860px;
            margin-left: auto;
            margin-right: auto;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .meal-selector h2 {
            color: #9b1111;
            margin-bottom: 0.8rem;
            font-size: 1.3rem;
            font-weight: 750;
            letter-spacing: -.02em;
        }
        
        @media (min-width: 768px) {
            .meal-selector { padding: 2.2rem 2rem; margin-bottom: 2rem; }
            .meal-selector h2 { font-size: 2rem; margin-bottom: 1.3rem; }
        }

        .meal-buttons {
            display: flex;
            justify-content: center;
            gap: 0.6rem;
            flex-wrap: wrap;
        }

        .meal-btn {
            border: 1px solid rgba(0,0,0,.06);
            background: #f2f3f5;
            color: #30343a;
            padding: 0.6rem 0.5rem;
            border-radius: 12px;
            cursor: pointer;
            transition: background .16s ease;
            box-shadow: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.1rem;
            text-align: center;
            line-height: 1.1;
            width: 48%; /* ä¸€è¡Œä¸¤ä¸ª */
            min-width: unset;
        }
        
        @media (min-width: 500px) {
            .meal-btn { width: auto; min-width: 140px; padding: 0.85rem 1.35rem; gap: 0.35rem; }
        }

        .meal-label { font-size: 0.9rem; font-weight: 650; }
        .meal-time { font-size: 0.7rem; font-weight: 600; opacity: .75; }
        
        @media (min-width: 768px) {
            .meal-label { font-size: 1.05rem; }
            .meal-time { font-size: 0.82rem; }
        }
        
        .meal-btn.active .meal-time { opacity: .9; }

        .meal-btn:hover { background: #eceef1; }
        .meal-btn.active {
            background: #b11212;
            border-color: rgba(177,18,18,.18);
            color: #fff;
            box-shadow: 0 4px 10px rgba(177,18,18,.22);
        }

        /* --- æ ¸å¿ƒä¿®æ”¹ï¼šç´§å‡‘çš„åŒåˆ—å¸ƒå±€ --- */
        .dining-halls {
            display: grid;
            /* å¼ºåˆ¶æ‰‹æœºç«¯ä¹Ÿæ˜¯ä¸¤åˆ—ï¼Œåˆ©ç”¨å®½åº¦ */
            grid-template-columns: repeat(2, 1fr); 
            gap: 0.6rem; /* å‡å°å¡ç‰‡é—´è· */
            margin-top: 1rem;
        }

        /* æœ€åä¸€ä¸ªå…ƒç´ å¦‚æœæ˜¯å•æ•°ï¼ˆæ¯”å¦‚ç¬¬3ä¸ªï¼‰ï¼Œè®©å®ƒæ¨ªè·¨å æ»¡åº•éƒ¨ï¼Œåˆ©ç”¨ç©ºé—´ */
        .dining-hall:last-child:nth-child(odd) {
            grid-column: span 2;
        }

        @media (min-width: 900px) {
            /* ç”µè„‘ç«¯æ¢å¤3åˆ—æˆ–4åˆ— */
            .dining-halls { 
                grid-template-columns: repeat(3, 1fr); 
                gap: 1.2rem;
            }
            .dining-hall:last-child:nth-child(odd) {
                grid-column: auto; /* ç”µè„‘ç«¯ä¸éœ€è¦æ¨ªè·¨ */
            }
        }
        @media (min-width: 1200px) {
            .dining-halls { grid-template-columns: repeat(3, 1fr); }
        }

        .dining-hall {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            overflow: hidden;
            transition: all 0.3s ease;
            animation: fadeInUp 0.6s ease-out;
            max-width: 100%;
            display: flex;
            flex-direction: column;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .hall-header {
            background: linear-gradient(135deg, #c62828 0%, #d32f2f 100%);
            color: white;
            padding: 0.6rem 0.4rem; /* å‡å°å¤´éƒ¨å†…è¾¹è· */
            text-align: center;
        }

        .hall-header h3 { 
            font-size: 1rem; /* å‡å°æ ‡é¢˜å­—å·ï¼Œé˜²æ­¢æ¢è¡Œ */
            margin-bottom: 0.1rem; 
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        @media (min-width: 768px) {
            .hall-header { padding: 1rem; }
            .hall-header h3 { font-size: 1.4rem; margin-bottom: 0.4rem; }
        }

        .hall-status {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 0.15rem 0.5rem;
            border-radius: 10px;
            font-size: 0.65rem; /* çŠ¶æ€å­—ä½“å˜å° */
            font-weight: 600;
        }
        @media (min-width: 768px) {
            .hall-status { padding: 0.4rem 0.8rem; font-size: 0.8rem; border-radius: 16px; }
        }

        .menu-content {
            padding: 0.5rem; /* å†…å®¹åŒºæ›´ç´§å‡‘ */
            /* é™åˆ¶é«˜åº¦ï¼Œè®©å¡ç‰‡å†…éƒ¨æ»šåŠ¨ï¼Œé˜²æ­¢æ•´ä¸ªé¡µé¢å¤ªé•¿ */
            height: 280px; 
            overflow-y: auto;
            flex-grow: 1;
        }
        
        @media (min-width: 768px) {
            .menu-content { padding: 1rem; height: 420px; }
        }

        .menu-content::-webkit-scrollbar { width: 4px; }
        .menu-content::-webkit-scrollbar-track { background: #f1f1f1; }
        .menu-content::-webkit-scrollbar-thumb { background: #c62828; border-radius: 4px; }

        .menu-category { margin-bottom: 0.8rem; animation: slideIn 0.5s ease-out; }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-10px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .category-title {
            color: #c62828;
            font-size: 0.9rem; /* ç±»åˆ«æ ‡é¢˜å˜å° */
            font-weight: 700;
            margin-bottom: 0.3rem;
            padding-bottom: 0.2rem;
            padding-left: 0.2rem;
            border-bottom: 1px solid #ffebee;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }
        
        @media (min-width: 768px) {
            .category-title { font-size: 1.1rem; margin-bottom: 0.5rem; border-bottom-width: 2px; }
        }

        .category-icon { font-size: 1rem; }

        .menu-items { list-style: none; padding-left: 0.2rem; }

        .menu-item {
            padding: 0.3rem 0;
            padding-left: 0.3rem;
            border-left: 2px solid transparent;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: flex-start; /* é˜²æ­¢é•¿èœåå¯¹ä¸é½ */
            font-size: 0.8rem; /* èœåå˜å°ï¼Œé€‚åˆåŒåˆ— */
            line-height: 1.3;
        }
        
        @media (min-width: 768px) {
            .menu-item { font-size: 0.95rem; padding: 0.4rem 0 0.4rem 0.8rem; }
        }

        .menu-item:hover {
            border-left-color: #c62828;
            background: #ffebee;
        }

        .menu-item-link {
            display: block;
            width: 100%;
            color: inherit;
            text-decoration: none;
        }
        
        .no-menu { text-align: center; padding: 1.5rem 0; color: #666; font-style: italic; font-size: 0.8rem; }
        .loading-message { text-align: center; padding: 1.5rem 0; color: #666; font-style: italic; font-size: 0.8rem; }

        .last-updated {
            text-align: center;
            color: #888;
            font-size: 0.65rem;
            margin-top: 0.5rem;
            padding-top: 0.4rem;
            border-top: 1px solid #ffebee;
            font-style: italic;
        }

        .about-content {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            max-width: 800px;
            margin: 0 auto;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            animation: fadeIn 0.6s ease-out;
            line-height: 1.6;
        }
        
        @media (min-width: 768px) {
            .about-content { padding: 3rem; line-height: 1.8; }
        }

        .about-content h2 {
            color: #c62828;
            font-size: 1.8rem;
            margin-bottom: 1rem;
            text-align: center;
        }

        .about-content p { font-size: 1rem; margin-bottom: 1rem; color: #333; }
        .about-content a { color: #c62828; text-decoration: underline; font-weight: 600; }
        .about-content a:hover { color: #b71c1c; }

        footer { text-align: center; padding: 2rem 1rem; color: #fff; margin-top: 2rem; font-size: 0.8rem; }

        /* ä¿®å¤æŒ‰é’®åœ¨ç‰¹å®šå®½åº¦çš„æ¢è¡Œé—®é¢˜ */
        .meal-buttons.weekday { flex-wrap: wrap; }
        @media (min-width: 900px) {
            .meal-buttons.weekday { flex-wrap: nowrap; }
        }
    </style>

    <script defer src="https://static.cloudflareinsights.com/beacon.min.js"
      data-cf-beacon='{"token": "b55eeac22b1c465d9a39541f96cbcdae"}'></script>

</head>

<body>
    <header>
        <div class="header-container">
            <div class="header-left">
                <h1>ğŸº Wolfie Dine</h1>
                <p class="tagline">Your campus dining companion</p>
            </div>
            <div class="clock-container">
                <div class="clock-time" id="clock-time">00:00:00</div>
                <div class="clock-date" id="clock-date">Loading...</div>
            </div>
        </div>
    </header>

    <nav>
        <div class="nav-container">
            <button class="nav-btn active" onclick="showPage('menu', this)">Menu</button>
            <button class="nav-btn" onclick="showPage('about', this)">About</button>
            <a class="nav-btn"
               href="https://docs.google.com/forms/d/e/1FAIpQLSfwXXeb2SHBLBE1TENjznsm8F5WlA5zCsay5n1cbmbJU2BTIQ/viewform?usp=sharing&ouid=114715764942658548801"
               target="_blank" rel="noopener noreferrer">Feedback</a>
        </div>
    </nav>

    <main>
        <div id="menu-page" class="page active">
            <div class="meal-selector">
                <h2>Select Meal Period</h2>
                <div class="meal-buttons" id="meal-buttons"></div>
            </div>
            <div class="dining-halls" id="dining-halls-container"></div>
        </div>

        <div id="about-page" class="page">
            <div class="about-content">
                <h2>About Wolfie Dine</h2>
                <p>
                    Wolfie Dine is a menu aggregator for the Stony Brook University dining halls that lets students see all meal options in one place.
                </p>
                <p>
                    Wolfie Dine was founded in January 2025 by Tina Yu [CC '26] and Chenhao Yu [CC '26]. It's maintained by current students and updates daily.
                </p>
                <p>
                    See the <a href="https://stonybrook.nutrislice.com" target="_blank" rel="noopener noreferrer">official Dining website</a>
                    for hours updates, nutritional information, service alerts[...]
                </p>
            </div>
        </div>
    </main>

    <footer>
        <p>&copy; 2026 Wolfie Dine. Bringing campus dining to your fingertips.</p>
    </footer>

    <script>
        const menuData = {
            'west-hall': {
                name: 'West Side Dining',
                isDynamic: true
            },
            'east-hall': {
                name: 'East Side Dining',
                isDynamic: true
            },
            'dental-cafe': {
                name: 'Dental CafÃ©',
                isDynamic: true
            }
        };

        if (!menuData['west-hall'].isDynamic) {
            menuData['west-hall'].latenight = menuData['west-hall'].dinner;
        }

        let dentalCafeData = null;
        let eastDiningData = null;
        let westDiningData = null;

        const categoryIcons = {
            'Breakfast Classics': 'ğŸ³',
            'Hot Breakfast': 'ğŸ³',
            'Healthy Options': 'ğŸ¥—',
            'Continental': 'ğŸ¥',
            'Beverages': 'â˜•',
            'Entrees': 'ğŸ½ï¸',
            'Sides': 'ğŸ¥˜',
            'Soups': 'ğŸ²',
            'Desserts': 'ğŸ°',
            'All Items': 'ğŸ´'
        };

        let currentMeal = 'breakfast';

        function pickInitialMeal() {
            const now = new Date();
            const day = now.getDay();
            const minutes = now.getHours() * 60 + now.getMinutes();

            const isWeekend = (day === 0 || day === 6);

            const schedule = isWeekend ? [
                { key: 'lunch', label: 'Brunch', time: '9amâ€“3:59pm', start: 9 * 60, end: 16 * 60 },
                { key: 'dinner', label: 'Dinner', time: '4pmâ€“11pm', start: 16 * 60, end: 23 * 60 }
            ] : [
                { key: 'breakfast', label: 'Breakfast', time: '7:30â€“10:59am', start: 7 * 60 + 30, end: 11 * 60 },
                { key: 'lunch', label: 'Lunch', time: '11amâ€“3:59pm', start: 11 * 60, end: 16 * 60 },
                { key: 'dinner', label: 'Dinner', time: '4pmâ€“9:59pm', start: 16 * 60, end: 22 * 60 },
                { key: 'late-night', label: 'Late Night', time: '10pmâ€“12am', start: 22 * 60, end: 24 * 60 }
            ];

            for (const slot of schedule) {
                if (minutes >= slot.start && minutes < slot.end) return slot.key;
            }
            for (const slot of schedule) {
                if (minutes < slot.start) return slot.key;
            }
            return schedule[0].key;
        }

        function applyMealSchedule() {
            const now = new Date();
            const day = now.getDay();
            const isWeekend = (day === 0 || day === 6);

            const schedule = isWeekend ? [
                { key: 'lunch', label: 'Brunch', time: '9amâ€“3:59pm' },
                { key: 'dinner', label: 'Dinner', time: '4pmâ€“11pm' }
            ] : [
                { key: 'breakfast', label: 'Breakfast', time: '7:30â€“10:59am' },
                { key: 'lunch', label: 'Lunch', time: '11amâ€“3:59pm' },
                { key: 'dinner', label: 'Dinner', time: '4pmâ€“9:59pm' },
                { key: 'late-night', label: 'Late Night', time: '10pmâ€“12am' }
            ];

            const buttonsWrap = document.getElementById('meal-buttons');
            if (!buttonsWrap) return;

            buttonsWrap.classList.toggle('weekday', !isWeekend);

            buttonsWrap.innerHTML = schedule.map(slot => `
                <div class="meal-option">
                    <button class="meal-btn" data-meal="${slot.key}">
                        <span class="meal-label">${slot.label}</span>
                        <span class="meal-time">${slot.time}</span>
                    </button>
                </div>
            `).join('');

            buttonsWrap.querySelectorAll('.meal-btn').forEach(btn => {
                btn.addEventListener('click', () => changeMeal(btn.dataset.meal));
            });
        }

        function setInitialMealUI(initialMeal) {
            currentMeal = initialMeal;
            document.querySelectorAll('.meal-btn').forEach(btn => btn.classList.remove('active'));

            const chosenBtn = document.querySelector(`[data-meal="${initialMeal}"]`);
            if (chosenBtn && chosenBtn.style.display !== 'none') {
                chosenBtn.classList.add('active');
            } else {
                const fallbackBtn = document.querySelector('[data-meal="lunch"]');
                if (fallbackBtn) {
                    currentMeal = 'lunch';
                    fallbackBtn.classList.add('active');
                }
            }

            renderDiningHalls();
        }

        async function loadDentalCafeData() {
            const controller = new AbortController();
            const timeout = setTimeout(() => controller.abort(), 9000);
            try {
                const response = await fetch('dental_cafe.json?ts=' + Date.now(), {
                    cache: 'no-store',
                    signal: controller.signal
                });
                if (!response.ok) throw new Error('Could not load menu');
                dentalCafeData = await response.json();
            } catch (error) {
                console.error('Error loading Dental Cafe data:', error);
                dentalCafeData = {
                    status: 'fetch_error',
                    message: 'Menu data unavailable (refresh or try again later)',
                    menu: [],
                    updated_at: ''
                };
            } finally {
                clearTimeout(timeout);
                renderDiningHalls();
            }
        }

        async function loadEastDiningData() {
            const controller = new AbortController();
            const timeout = setTimeout(() => controller.abort(), 9000);
            try {
                const response = await fetch('east_dining.json?ts=' + Date.now(), {
                    cache: 'no-store',
                    signal: controller.signal
                });
                if (!response.ok) throw new Error('Could not load menu');
                eastDiningData = await response.json();
            } catch (error) {
                console.error('Error loading East Dining data:', error);
                eastDiningData = {
                    status: 'fetch_error',
                    message: 'Menu data unavailable (refresh or try again later)',
                    meals: {},
                    updated_at: '',
                    is_weekend: false
                };
            } finally {
                clearTimeout(timeout);
                renderDiningHalls();
            }
        }

        async function loadWestDiningData() {
            const controller = new AbortController();
            const timeout = setTimeout(() => controller.abort(), 9000);
            try {
                const response = await fetch('west_dining.json?ts=' + Date.now(), {
                    cache: 'no-store',
                    signal: controller.signal
                });
                if (!response.ok) throw new Error('Could not load menu');
                westDiningData = await response.json();
            } catch (error) {
                console.error('Error loading West Dining data:', error);
                westDiningData = {
                    status: 'fetch_error',
                    message: 'Menu data unavailable (refresh or try again later)',
                    meals: {},
                    updated_at: '',
                    is_weekend: false
                };
            } finally {
                clearTimeout(timeout);
                renderDiningHalls();
            }
        }

        function updateClock() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            const timeString = `${hours}:${minutes}:${seconds}`;

            const days = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
            const months = ['January','February','March','April','May','June','July','August','September','October','November','December'];
            const dayOfWeek = days[now.getDay()];
            const month = months[now.getMonth()];
            const date = now.getDate();
            const year = now.getFullYear();
            const dateString = `${dayOfWeek}, ${month} ${date}, ${year}`;

            document.getElementById('clock-time').textContent = timeString;
            document.getElementById('clock-date').textContent = dateString;
        }

        setInterval(updateClock, 1000);
        updateClock();

        function showPage(pageName, btn) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.getElementById(`${pageName}-page`).classList.add('active');

            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            if (btn) btn.classList.add('active');

            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function nutrisliceDentalCafeDayUrl(dateStr) {
            const base = "https://stonybrook.nutrislice.com/menu/sbu-eats-events/dental-cafe";
            if (!dateStr) return base;
            return `${base}?day=${encodeURIComponent(dateStr)}`;
        }

        function nutrisliceEastSideSpecialsDayUrl(dateStr) {
            const base = "https://stonybrook.nutrislice.com/menu/east-side-dining/todays-dine-in-specials-esd";
            if (!dateStr) return base;
            return `${base}?day=${encodeURIComponent(dateStr)}`;
        }

        function nutrisliceWestSideSpecialsDayUrl(dateStr) {
            const base = "https://stonybrook.nutrislice.com/menu/west-side-dining/todays-dine-in-specials-wsd";
            if (!dateStr) return base;
            return `${base}?day=${encodeURIComponent(dateStr)}`;
        }

        function getEastSideDineInHoursLabel() {
            const d = new Date();
            const day = d.getDay();
            const isWeekend = (day === 0 || day === 6);
            return isWeekend ? "9amâ€“11pm" : "7:30amâ€“12am";
        }

        function getWestSideDineInHoursLabel() {
            const d = new Date();
            const day = d.getDay();
            const isWeekend = (day === 0 || day === 6);
            return isWeekend ? "9amâ€“11pm" : "7:30amâ€“12am";
        }

        function renderDentalCafeContent() {
            if (dentalCafeData === null) {
                return '<div class="loading-message">Loading...</div>';
            }

            const status = dentalCafeData.status || '';
            const message = dentalCafeData.message || '';
            const menu = Array.isArray(dentalCafeData.menu) ? dentalCafeData.menu : [];

            const updated = dentalCafeData.updated_at
                ? `<div class="last-updated">Last updated: ${dentalCafeData.updated_at}</div>`
                : '';

            if (menu.length === 0) {
                const text = message || 'No menu available.';
                const style = status === 'fetch_error' ? 'style="color:#b71c1c"' : '';
                return `<div class="no-menu" ${style}>${text}</div>${updated}`;
            }

            const dateStr = (dentalCafeData && dentalCafeData.date)
                ? dentalCafeData.date
                : (dentalCafeData && dentalCafeData.updated_at ? dentalCafeData.updated_at.split(' ')[0] : null);

            const href = nutrisliceDentalCafeDayUrl(dateStr);

            const items = menu.map(item => `
                <li class="menu-item">
                    <a class="menu-item-link" href="${href}" target="_blank" rel="noopener noreferrer">
                        <span>${item.name}</span>
                    </a>
                </li>
            `).join("");

            return `
                <div class="menu-category">
                    <h4 class="category-title">
                        <span class="category-icon">ğŸ´</span>
                        Today
                    </h4>
                    <ul class="menu-items">${items}</ul>
                </div>
                ${updated}
            `;
        }

        function renderEastDiningContent() {
            if (eastDiningData === null) {
                return '<div class="loading-message">Loading...</div>';
            }

            const status = eastDiningData.status || '';
            const message = eastDiningData.message || '';
            const meals = eastDiningData.meals || {};

            const updated = eastDiningData.updated_at
                ? `<div class="last-updated">Last updated: ${eastDiningData.updated_at}</div>`
                : '';

            const dateStr = (eastDiningData && eastDiningData.date)
                ? eastDiningData.date
                : (eastDiningData && eastDiningData.updated_at ? eastDiningData.updated_at.split(' ')[0] : null);

            const itemHref = nutrisliceEastSideSpecialsDayUrl(dateStr);

            let mealKey = currentMeal;
            if (mealKey === 'late-night') mealKey = 'late_night';

            if (eastDiningData.is_weekend) {
                if (mealKey === 'lunch' || mealKey === 'breakfast') mealKey = 'brunch';
                if (mealKey === 'late_night') mealKey = 'dinner';
            }

            const blocks = Array.isArray(meals[mealKey]) ? meals[mealKey] : [];

            if (blocks.length === 0) {
                const text = message || 'No menu available.';
                const style = status === 'fetch_error' ? 'style="color:#b71c1c"' : '';
                return `<div class="no-menu" ${style}>${text}</div>${updated}`;
            }

            const htmlBlocks = blocks.map(b => {
                const section = b.section || 'Menu';
                const items = Array.isArray(b.items) ? b.items : [];

                const li = items.map(name => `
                    <li class="menu-item">
                        <a class="menu-item-link" href="${itemHref}" target="_blank" rel="noopener noreferrer">
                            <span>${name}</span>
                        </a>
                    </li>
                `).join('');

                return `
                    <div class="menu-category">
                        <h4 class="category-title">
                            <span class="category-icon">ğŸ´</span>
                            ${section}
                        </h4>
                        <ul class="menu-items">${li}</ul>
                    </div>
                `;
            }).join('');

            return `${htmlBlocks}${updated}`;
        }

        function renderWestDiningContent() {
            if (westDiningData === null) {
                return '<div class="loading-message">Loading...</div>';
            }

            const status = westDiningData.status || '';
            const message = westDiningData.message || '';
            const meals = westDiningData.meals || {};

            const updated = westDiningData.updated_at
                ? `<div class="last-updated">Last updated: ${westDiningData.updated_at}</div>`
                : '';

            const dateStr = (westDiningData && westDiningData.date)
                ? westDiningData.date
                : (westDiningData && westDiningData.updated_at ? westDiningData.updated_at.split(' ')[0] : null);

            const itemHref = nutrisliceWestSideSpecialsDayUrl(dateStr);

            let mealKey = currentMeal;
            if (mealKey === 'late-night') mealKey = 'late_night';

            if (westDiningData.is_weekend) {
                if (mealKey === 'lunch' || mealKey === 'breakfast') mealKey = 'brunch';
                if (mealKey === 'late_night') mealKey = 'dinner';
            }

            const blocks = Array.isArray(meals[mealKey]) ? meals[mealKey] : [];

            if (blocks.length === 0) {
                const text = message || 'No menu available.';
                const style = status === 'fetch_error' ? 'style="color:#b71c1c"' : '';
                return `<div class="no-menu" ${style}>${text}</div>${updated}`;
            }

            const htmlBlocks = blocks.map(b => {
                const section = b.section || 'Menu';
                const items = Array.isArray(b.items) ? b.items : [];

                const li = items.map(name => `
                    <li class="menu-item">
                        <a class="menu-item-link" href="${itemHref}" target="_blank" rel="noopener noreferrer">
                            <span>${name}</span>
                        </a>
                    </li>
                `).join('');

                return `
                    <div class="menu-category">
                        <h4 class="category-title">
                            <span class="category-icon">ğŸ´</span>
                            ${section}
                        </h4>
                        <ul class="menu-items">${li}</ul>
                    </div>
                `;
            }).join('');

            return `${htmlBlocks}${updated}`;
        }

        function renderStaticHallMenu(menu) {
            if (!menu || Object.keys(menu).length === 0) {
                return '<div class="no-menu">No menu available</div>';
            }

            return Object.keys(menu).map(category => {
                const icon = categoryIcons[category] || 'ğŸ´';
                const items = menu[category]
                    .map(item => `<li class="menu-item"><span>${item}</span></li>`)
                    .join('');

                return `
                    <div class="menu-category">
                        <h4 class="category-title">
                            <span class="category-icon">${icon}</span>
                            ${category}
                        </h4>
                        <ul class="menu-items">${items}</ul>
                    </div>
                `;
            }).join('');
        }

        function renderDiningHalls() {
            const container = document.getElementById('dining-halls-container');
            container.innerHTML = '';

            Object.keys(menuData).forEach(hallId => {
                const hall = menuData[hallId];
                const hallDiv = document.createElement('div');
                hallDiv.className = 'dining-hall';

                let menuContent;
                if (hall.isDynamic) {
                    if (hallId === 'dental-cafe') {
                        menuContent = renderDentalCafeContent();
                    } else if (hallId === 'east-hall') {
                        menuContent = renderEastDiningContent();
                    } else if (hallId === 'west-hall') {
                        menuContent = renderWestDiningContent();
                    } else {
                        menuContent = '<div class="no-menu">Not configured</div>';
                    }
                } else {
                    const staticKey = (currentMeal === 'late-night') ? 'latenight' : currentMeal;
                    const menu = hall[staticKey];
                    menuContent = renderStaticHallMenu(menu);
                }

                const statusText = (hallId === 'east-hall')
                    ? getEastSideDineInHoursLabel()
                    : (hallId === 'west-hall')
                        ? getWestSideDineInHoursLabel()
                        : 'Open';

                hallDiv.innerHTML = `
                    <div class="hall-header">
                        <h3>${hall.name}</h3>
                        <span class="hall-status">${statusText}</span>
                    </div>
                    <div class="menu-content">
                        ${menuContent}
                    </div>
                `;

                container.appendChild(hallDiv);
            });
        }

        function changeMeal(meal) {
            currentMeal = meal;
            document.querySelectorAll('.meal-btn').forEach(btn => btn.classList.remove('active'));
            const activeBtn = document.querySelector(`[data-meal="${meal}"]`);
            if (activeBtn) activeBtn.classList.add('active');
            renderDiningHalls();
        }

        applyMealSchedule();
        setInitialMealUI(pickInitialMeal());
        loadDentalCafeData();
        loadEastDiningData();
        loadWestDiningData();
        renderDiningHalls();
    </script>
</body>
</html>
